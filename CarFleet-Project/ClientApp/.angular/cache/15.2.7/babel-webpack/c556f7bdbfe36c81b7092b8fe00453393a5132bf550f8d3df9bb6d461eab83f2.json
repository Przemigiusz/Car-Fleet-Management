{"ast":null,"code":"import { __decorate } from \"tslib\";\n/* eslint-disable @angular-eslint/component-selector */\n/* eslint-disable no-debugger */\nimport { Component } from '@angular/core';\nimport { Vehicle } from '../../models/Vehicle';\nimport { FormGroup, Validators, FormControl } from '@angular/forms';\nimport { ReplaySubject, takeUntil, map, forkJoin } from 'rxjs';\nimport { createAtLeastOneValidator } from '../../custom-validators/at-least-one';\nimport { createIsAnOptionValidator } from '../../custom-validators/is-an-option';\nlet NewCarComponent = class NewCarComponent {\n  changeStateOfModels() {\n    console.log(\"CHANGE!!!!\");\n  }\n  onSubmit() {\n    this.submitClicked = true;\n  }\n  displaySelectOptions() {\n    console.log(\"Event has been fired\");\n    this.optionsHidden ? this.optionsHidden = false : this.optionsHidden = true;\n  }\n  changeFuelsState() {\n    this.areFuelsLoaded = true;\n  }\n  updateChoosenFuels(formControlName) {\n    if (this.addCarForm.get('fuelsOptions').get(formControlName).value) {\n      this.chosenFuels.push(formControlName);\n    } else {\n      const index = this.chosenFuels.indexOf(formControlName, 0);\n      if (index > -1) {\n        this.chosenFuels.splice(index, 1);\n      }\n    }\n  }\n  updateValue(opElement) {\n    if (opElement.isChecked === false) {\n      opElement.isChecked = true;\n    } else {\n      opElement.isChecked = false;\n    }\n  }\n  constructor(addCarService, getEquipmentElementsService, formBuilder, getFiltersService, loadingSpinnerService) {\n    this.addCarService = addCarService;\n    this.getEquipmentElementsService = getEquipmentElementsService;\n    this.formBuilder = formBuilder;\n    this.getFiltersService = getFiltersService;\n    this.loadingSpinnerService = loadingSpinnerService;\n    this.isExpanded = false;\n    this.addCarForm = new FormGroup({});\n    this.equipment = []; //Whole equipment elements\n    this.operationalEquipment = []; //Elements which are available in the car\n    this.vehicleImages = []; //Photos of the car\n    this.chosenFuels = [];\n    this.brands = [];\n    this.models = [];\n    this.fuels = [];\n    this.carbodies = [];\n    this.transmissionTypes = [];\n    this.years = [];\n    this.onDestroy$ = new ReplaySubject(1);\n    this.optionsHidden = true;\n    this.areFuelsLoaded = false;\n    this.submitClicked = false;\n  }\n  ngOnDestroy() {\n    this.onDestroy$.next(true);\n    this.onDestroy$.complete();\n    this.loadingSpinnerService.changeSpinnerState(false);\n    console.log(\"ngOnDestroy - newCar\");\n  }\n  ngOnInit() {\n    this.initForm();\n    forkJoin([this.getEquipmentElements(), this.getCarbodies(), this.getFuels(), this.getTransmissionTypes(), this.getModels(), this.getBrands(), this.getYears()]).pipe(takeUntil(this.onDestroy$)).subscribe({\n      next: r => {\n        this.loadingSpinnerService.changeSpinnerState(true);\n        this.initFuelOptions();\n        this.changeFuelsState();\n      },\n      error: err => {\n        console.log(\"error\", err);\n      }\n    });\n  }\n  initForm() {\n    this.addCarForm = this.formBuilder.group({\n      brand: ['', [Validators.required, createIsAnOptionValidator(this.brands)]],\n      model: [{\n        value: '',\n        disabled: true\n      }, [Validators.required, createIsAnOptionValidator(this.models)]],\n      yearOfProduction: ['', [Validators.required, createIsAnOptionValidator(this.years)]],\n      mileage: ['', Validators.required],\n      carbodyType: ['', [Validators.required, createIsAnOptionValidator(this.carbodies)]],\n      transmissionType: ['', [Validators.required, createIsAnOptionValidator(this.transmissionTypes)]],\n      vehicleImage: ['', Validators.required]\n    });\n    this.addCarForm.addControl('fuelsOptions', new FormGroup({}));\n    this.addCarForm.get('fuelsOptions').addValidators(createAtLeastOneValidator());\n  }\n  initFuelOptions() {\n    const fuelsTemp = this.addCarForm.controls.fuelsOptions;\n    for (const fuel of this.fuels) {\n      fuelsTemp.addControl(fuel.fuelName, new FormControl(false));\n    }\n  }\n  fileChanged(event) {\n    const imageInputElement = event.target;\n    if (imageInputElement.files && imageInputElement.files.length > 0) {\n      const files = imageInputElement.files;\n      for (const file of files) {\n        this.vehicleImages.push(file);\n      }\n    }\n  }\n  submitForm() {\n    if (this.addCarForm.valid) {\n      const formData = this.addCarForm.value;\n      const newVehicle = new Vehicle();\n      newVehicle.brandId = this.brands.find(brand => brand.brandName === formData.brand).brandId;\n      newVehicle.modelId = this.models.find(model => model.modelName === formData.model).modelId;\n      newVehicle.yearOfProductionId = this.years.find(year => year.year === formData.yearOfProduction).yearId;\n      newVehicle.mileage = formData.mileage;\n      formData.fuels.forEach(f1 => {\n        const matchingFuel = this.fuels.find(f2 => f2.fuelName === f1);\n        if (matchingFuel) {\n          newVehicle.fuels.push(matchingFuel);\n        }\n      });\n      newVehicle.carbodyId = this.carbodies.find(c => c.carbodyName === formData.carBodyType).carbodyId;\n      for (const opElement of this.operationalEquipment) {\n        if (opElement.isChecked === true) {\n          const matchingEquipmentElement = this.equipment.find(ee => ee.elementId === opElement.eqElement.elementId);\n          if (matchingEquipmentElement) {\n            newVehicle.equipment.push(matchingEquipmentElement);\n          }\n        }\n      }\n      this.addCarService.addVehicle(newVehicle).pipe(takeUntil(this.onDestroy$)).subscribe({\n        next: r => {\n          debugger;\n        },\n        error: err => {\n          console.log(\"błąd\"), console.log(err);\n        }\n      });\n    } else {\n      console.log(\"Form is not valid!!!\");\n      this.getFormValidationErrors();\n    }\n  }\n  getFormValidationErrors() {\n    Object.keys(this.addCarForm.controls).forEach((key, value) => {\n      const controlErrors = this.addCarForm.get(key).errors;\n      Object.keys(controlErrors || {}).forEach(keyError => {\n        console.log(`Key control: ${key}, keyError: ${keyError}, errValue: ${controlErrors[keyError]}`);\n      });\n    });\n  }\n  getEquipmentElements() {\n    return this.getEquipmentElementsService.getEquipmentElements().pipe(map(r => this.equipment = r));\n  }\n  getCarbodies() {\n    return this.getFiltersService.getCarbodies().pipe(map(r => this.carbodies = r));\n  }\n  getFuels() {\n    return this.getFiltersService.getFuels().pipe(map(r => this.fuels = r));\n  }\n  getTransmissionTypes() {\n    return this.getFiltersService.getTransmissionTypes().pipe(map(r => this.transmissionTypes = r));\n  }\n  getModels() {\n    return this.getFiltersService.getModels().pipe(map(r => this.models = r));\n  }\n  getBrands() {\n    return this.getFiltersService.getBrands().pipe(map(r => this.brands = r));\n  }\n  getYears() {\n    return this.getFiltersService.getYears().pipe(map(r => this.years = r));\n  }\n  collapse() {\n    this.isExpanded = false;\n  }\n  toggle() {\n    this.isExpanded = !this.isExpanded;\n  }\n};\nNewCarComponent = __decorate([Component({\n  selector: 'new-car',\n  templateUrl: './new-car.component.html',\n  styleUrls: ['./new-car.component.css']\n})], NewCarComponent);\nexport { NewCarComponent };","map":{"version":3,"mappings":"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","names":["Component","Vehicle","FormGroup","Validators","FormControl","ReplaySubject","takeUntil","map","forkJoin","createAtLeastOneValidator","createIsAnOptionValidator","NewCarComponent","changeStateOfModels","console","log","onSubmit","submitClicked","displaySelectOptions","optionsHidden","changeFuelsState","areFuelsLoaded","updateChoosenFuels","formControlName","addCarForm","get","value","chosenFuels","push","index","indexOf","splice","updateValue","opElement","isChecked","constructor","addCarService","getEquipmentElementsService","formBuilder","getFiltersService","loadingSpinnerService","ngOnDestroy","onDestroy$","next","complete","changeSpinnerState","ngOnInit","initForm","getEquipmentElements","getCarbodies","getFuels","getTransmissionTypes","getModels","getBrands","getYears","pipe","subscribe","r","initFuelOptions","error","err","group","brand","required","brands","model","disabled","models","yearOfProduction","years","mileage","carbodyType","carbodies","transmissionType","transmissionTypes","vehicleImage","addControl","addValidators","fuelsTemp","controls","fuelsOptions","fuel","fuels","fuelName","fileChanged","event","imageInputElement","target","files","length","file","vehicleImages","submitForm","valid","formData","newVehicle","brandId","find","brandName","modelId","modelName","yearOfProductionId","year","yearId","forEach","f1","matchingFuel","f2","carbodyId","c","carbodyName","carBodyType","operationalEquipment","matchingEquipmentElement","equipment","ee","elementId","eqElement","addVehicle","getFormValidationErrors","Object","keys","key","controlErrors","errors","keyError","collapse","isExpanded","toggle","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["C:\\Users\\rutko\\source\\repos\\Car-Fleet-Management\\CarFleet-Project\\ClientApp\\src\\app\\new-car\\new-car.component.ts"],"sourcesContent":["/* eslint-disable @angular-eslint/component-selector */\r\n/* eslint-disable no-debugger */\r\nimport { Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { VehiclesService } from '../../services/vehicles.service';\r\nimport { EquipmentService } from '../../services/equipment.service';\r\nimport { FiltersService } from '../../services/filters.service';\r\nimport { LoadingSpinnerService } from '../../services/loading-spinner.service';\r\nimport { AddCarInterface } from '../../interfaces/add-car.interface';\r\nimport { Vehicle } from '../../models/Vehicle';\r\nimport { EquipmentElement } from '../../models/EquipmentElement';\r\nimport { FormBuilder, FormGroup, Validators, ValidationErrors, FormControl } from '@angular/forms';\r\nimport { ReplaySubject, takeUntil, map, forkJoin } from 'rxjs';\r\nimport { Brand } from '../../models/Brand';\r\nimport { Model } from '../../models/Model';\r\nimport { Fuel } from '../../models/Fuel';\r\nimport { Carbody } from '../../models/Carbody';\r\nimport { TransmissionType } from '../../models/TransmissionType';\r\nimport { OperationalEquipment } from '../../interfaces/operational-equipment.interface';\r\nimport { YearOfProduction } from '../../models/YearOfProduction';\r\nimport { createAtLeastOneValidator } from '../../custom-validators/at-least-one';\r\nimport { createIsAnOptionValidator } from '../../custom-validators/is-an-option';\r\nimport { createIsBrandChosenValidator } from '../../custom-validators/is-brand-chosen';\r\n\r\n@Component({\r\n  selector: 'new-car',\r\n  templateUrl: './new-car.component.html',\r\n  styleUrls: ['./new-car.component.css'],\r\n})\r\nexport class NewCarComponent implements OnInit, OnDestroy {\r\n  private isExpanded = false;\r\n  public addCarForm: FormGroup = new FormGroup({});\r\n\r\n  private equipment: EquipmentElement[] = []; //Whole equipment elements\r\n  public operationalEquipment: OperationalEquipment[] = []; //Elements which are available in the car\r\n  public vehicleImages: File[] = []; //Photos of the car\r\n\r\n  public chosenFuels: string[] = [];\r\n\r\n  public brands: Brand[] = [];\r\n  public models: Model[] = [];\r\n  public fuels: Fuel[] = [];\r\n  public carbodies: Carbody[] = [];\r\n  public transmissionTypes: TransmissionType[] = [];\r\n  public years: YearOfProduction[] = [];\r\n\r\n  private onDestroy$: ReplaySubject<boolean> = new ReplaySubject<boolean>(1);\r\n\r\n  public optionsHidden = true;\r\n\r\n  public areFuelsLoaded = false;\r\n\r\n  public submitClicked = false;\r\n\r\n  changeStateOfModels() {\r\n    console.log(\"CHANGE!!!!\");\r\n  }\r\n\r\n  onSubmit() {\r\n    this.submitClicked = true;\r\n  }\r\n\r\n  displaySelectOptions() {\r\n    console.log(\"Event has been fired\");\r\n    (this.optionsHidden) ? this.optionsHidden = false : this.optionsHidden = true;\r\n  }\r\n\r\n  changeFuelsState() {\r\n    this.areFuelsLoaded = true;\r\n  }\r\n\r\n  updateChoosenFuels(formControlName: string) {\r\n    if (this.addCarForm.get('fuelsOptions')!.get(formControlName)!.value) {\r\n      this.chosenFuels.push(formControlName);\r\n    } else {\r\n      const index = this.chosenFuels.indexOf(formControlName, 0);\r\n      if (index > -1) {\r\n        this.chosenFuels.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  updateValue(opElement: OperationalEquipment) {\r\n    if (opElement.isChecked === false) {\r\n      opElement.isChecked = true;\r\n    } else {\r\n      opElement.isChecked = false;\r\n    }\r\n }\r\n\r\n  constructor(private addCarService: VehiclesService, private getEquipmentElementsService: EquipmentService,\r\n    private formBuilder: FormBuilder, private getFiltersService: FiltersService, private loadingSpinnerService: LoadingSpinnerService) {}\r\n\r\n  public ngOnDestroy(): void {\r\n    this.onDestroy$.next(true);\r\n    this.onDestroy$.complete();\r\n    this.loadingSpinnerService.changeSpinnerState(false);\r\n    console.log(\"ngOnDestroy - newCar\");\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.initForm();\r\n    forkJoin([\r\n      this.getEquipmentElements(),\r\n      this.getCarbodies(),\r\n      this.getFuels(),\r\n      this.getTransmissionTypes(),\r\n      this.getModels(),\r\n      this.getBrands(),\r\n      this.getYears()\r\n    ])\r\n      .pipe(takeUntil(this.onDestroy$))\r\n      .subscribe(\r\n         {\r\n          next: r => {\r\n             this.loadingSpinnerService.changeSpinnerState(true);\r\n             this.initFuelOptions();\r\n             this.changeFuelsState();\r\n          },\r\n           error: err => { console.log(\"error\", err); },\r\n         }\r\n      )\r\n  }\r\n\r\n  initForm() {\r\n    this.addCarForm = this.formBuilder.group({\r\n      brand: ['', [Validators.required, createIsAnOptionValidator(this.brands)]],\r\n      model: [{value: '', disabled: true}, [Validators.required, createIsAnOptionValidator(this.models)]],\r\n      yearOfProduction: ['', [Validators.required, createIsAnOptionValidator(this.years)]],\r\n      mileage: ['', Validators.required],\r\n      carbodyType: ['', [Validators.required, createIsAnOptionValidator(this.carbodies)]],\r\n      transmissionType: ['', [Validators.required, createIsAnOptionValidator(this.transmissionTypes)]],\r\n      vehicleImage: ['', Validators.required]\r\n    });\r\n    this.addCarForm.addControl('fuelsOptions', new FormGroup({}));\r\n    this.addCarForm.get('fuelsOptions')!.addValidators(createAtLeastOneValidator());\r\n  }\r\n\r\n  initFuelOptions() {\r\n    const fuelsTemp: FormGroup = this.addCarForm.controls.fuelsOptions as FormGroup;\r\n    for (const fuel of this.fuels) {\r\n      fuelsTemp.addControl(fuel.fuelName, new FormControl(false));\r\n    }\r\n  }\r\n \r\n  fileChanged(event: Event) {\r\n    const imageInputElement = event.target as HTMLInputElement;\r\n    if (imageInputElement.files && imageInputElement.files.length > 0) {\r\n      const files = imageInputElement.files;\r\n      for (const file of files) {\r\n        this.vehicleImages.push(file);\r\n      }\r\n    }\r\n  }\r\n\r\n  submitForm() {\r\n    if (this.addCarForm.valid) {\r\n      const formData: AddCarInterface = this.addCarForm.value;\r\n      const newVehicle: Vehicle = new Vehicle();\r\n\r\n      newVehicle.brandId = this.brands.find(brand => brand.brandName === formData.brand)!.brandId!;\r\n      newVehicle.modelId = this.models.find(model => model.modelName === formData.model)!.modelId!;\r\n\r\n      newVehicle.yearOfProductionId = this.years.find(year => year.year === formData.yearOfProduction)!.yearId!;\r\n      newVehicle.mileage = formData.mileage;\r\n\r\n      formData.fuels.forEach(f1 => {\r\n        const matchingFuel = this.fuels.find(f2 => f2.fuelName === f1);\r\n        if (matchingFuel) {\r\n          newVehicle.fuels.push(matchingFuel);\r\n        }\r\n      })\r\n\r\n      newVehicle.carbodyId = this.carbodies.find(c => c.carbodyName === formData.carBodyType)!.carbodyId!;\r\n\r\n      for (const opElement of this.operationalEquipment) {\r\n        if (opElement.isChecked === true) {\r\n          const matchingEquipmentElement = this.equipment.find(ee => ee.elementId === opElement.eqElement.elementId);\r\n          if (matchingEquipmentElement) {\r\n            newVehicle.equipment.push(matchingEquipmentElement);\r\n          }\r\n        }\r\n      }\r\n      this.addCarService.addVehicle(newVehicle)\r\n        .pipe(takeUntil(this.onDestroy$))\r\n        .subscribe(\r\n          {\r\n            next: r => { debugger },\r\n            error: err => { console.log(\"błąd\"), console.log(err) }\r\n          });\r\n    }\r\n    else {\r\n      console.log(\"Form is not valid!!!\");\r\n      this.getFormValidationErrors();\r\n    } \r\n  }\r\n\r\n  getFormValidationErrors() {\r\n    Object.keys(this.addCarForm.controls).forEach((key,value) => {\r\n      const controlErrors: ValidationErrors = this.addCarForm.get(key)!.errors!;\r\n      Object.keys(controlErrors || {}).forEach(keyError => {\r\n        console.log(`Key control: ${key}, keyError: ${keyError}, errValue: ${controlErrors[keyError]}`);\r\n      });\r\n    });\r\n  }\r\n\r\n  private getEquipmentElements() {\r\n    return this.getEquipmentElementsService.getEquipmentElements()\r\n      .pipe(map(r => this.equipment = r));\r\n  }\r\n  private getCarbodies() {\r\n    return this.getFiltersService.getCarbodies()\r\n      .pipe(map(r => this.carbodies = r));\r\n  }\r\n  private getFuels() {\r\n    return this.getFiltersService.getFuels()\r\n      .pipe(map(r => this.fuels = r));\r\n  }\r\n  private getTransmissionTypes() {\r\n    return this.getFiltersService.getTransmissionTypes()\r\n      .pipe(map(r => this.transmissionTypes = r));\r\n  }\r\n  private getModels() {\r\n    return this.getFiltersService.getModels()\r\n      .pipe(map(r => this.models = r));\r\n  }\r\n  private getBrands() {\r\n    return this.getFiltersService.getBrands()\r\n      .pipe(map(r => this.brands = r));\r\n  }\r\n  private getYears() {\r\n    return this.getFiltersService.getYears()\r\n      .pipe(map(r => this.years = r));\r\n  }\r\n\r\n  collapse() {\r\n    this.isExpanded = false;\r\n  }\r\n\r\n  toggle() {\r\n    this.isExpanded = !this.isExpanded;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}